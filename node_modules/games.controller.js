var debug = require('debug')('games.controller.js');

function Gamescontroller(){}

Gamescontroller.prototype.playersdata = {};

/*
    # создает связку между игроками, сохраняя сокеты противников
*/
Gamescontroller.prototype.addGame = function(player1 , player2){
    var p1 = ('id' in player1 && 'socket' in player1) ? player1 : false;
    var p2 = ('id' in player2 && 'socket' in player2) ? player2 : false;
    
    if(p1 && p2){
        
        this.playersdata[p1.id] =
                {
                    id          : p1.id ,
                    socket      : p1.socket ,
                    
                    enemyid     : p2.id ,
                    enemysocket : p2.socket
                };
                
        this.playersdata[p2.id] =
                {
                    id          : p2.id ,
                    socket      : p2.socket ,
                    
                    enemyid     : p1.id ,
                    enemysocket : p1.socket
                };
    }else{
        debug('ERROR. Переданы не все данные игроков');
    }
    
};

Gamescontroller.prototype.sendEnemyData = function(selfid , title , data){
    if(this.playersdata[selfid] !== undefined){
       this.playersdata[selfid].enemysocket.emit(title , data);
    }else{
        debug('ERROR. Не найден объект игрока, при отправке запроса ' , title);
    }
};

Gamescontroller.prototype.sendSelfData = function(selfid , title , data){
    if(this.playersdata[selfid] !== undefined){
        this.playersdata[selfid].socket.emit(title , data);
    }else{
        debug('ERROR. Не найден объект игрока, при отправке запроса' , title);
    }
};

Gamescontroller.prototype.set = function(selfid , key , value){
    if(key !== undefined){
        if(value !== undefined){
            if(this.playersdata[selfid] !== undefined){
                this.playersdata[selfid][key] = value;
                return true;
            }else{
                debug('ERROR. Не найден объект игрока (gamescontroller.set)' , selfid);
                return false;
            }
        }else{
            debug('Ошибка при установкое занчение, атрибут value === undefined (gamescontroller.set)');
            return false;
        }
    }else{
        debug('Ошибка при установкое занчение, атрибут key === undefined (gamescontroller.set)');
        return false;
    }
}

Gamescontroller.prototype.get = function(selfid , key){
    if(key !== undefined){
        if(this.playersdata[selfid] !== undefined){
            if(key in this.playersdata[selfid]){
                debug('HERE' , key);
                
                return this.playersdata[selfid][key];
            }else{
                debug('ERROR. Не найден параметр в объекте - ' , key , '(gamescontroller.get)');
            }
        }else{
            debug('ERROR. Не найден объект игрока (gamescontroller.get)' , selfid);
            return false;
        }
    }else{
        debug('Ошибка при установкое занчение, атрибут key === undefined (gamescontroller.get)');
        return false;
    }
}

Gamescontroller.prototype.setPlayerLogin = function(id , login){
    if(this.set(id , 'login' , login)){
        debug('INFO. Добавлен новый login' , login);
    }else{
        debug('ERROR. Ошибка при добавлении нового login' , login);
    }
}

module.exports = Gamescontroller;